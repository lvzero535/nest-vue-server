# 项目 Docker 化

## 基础镜像

### ARG

用于构建阶段，为构建过程提供可配置参数，在容器运行时不可用。如果使用多阶段构建，每个阶段的 ARG 参数相互独立。

1. 从构建命令的 --build-arg中获取；如：docker build --build-arg PROJECT_DIR=nest-vue-server -t nest-vue-server .
2. 可以给定一个默认值。如 PROJECT_DIR=/nest-admin

### ENV

用于设置容器运行时的环境变量，在构建和运行阶段都有效。

### RUN

用于在构建阶段执行命令，如安装依赖、编译代码等。

## 多阶段构建

### 概念

多阶段构建通过将镜像构建过程拆分成多个阶段，每个阶段负责不同的任务，例如编译代码、测试、打包等。最终生成的镜像只包含运行应用所需的最小化依赖和文件，而不会包含构建过程中的中间产物和工具。

### 优势

1. 减小镜像体积：每个阶段可以选择仅复制最终需要的文件到下一个阶段，避免将构建工具、临时文件等不必要的内容包含在最终镜像中，从而显著减小镜像体积。
2. 简化 Dockerfile：将不同的构建任务分离到不同的阶段，使 Dockerfile 结构更清晰，易于维护和理解。
3. 提高构建效率：不同阶段可以并行构建，而且由于最终镜像体积小，拉取和部署速度也会更快。
